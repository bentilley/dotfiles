#!/usr/bin/env bash

source setup_lib.bash

CONFIG_DIR="$HOME/.config"

main() {
  printf "Hello Ben. Let's sync your dotfiles :)\n\n"
  symlinking_config_files
  check_third_party_tools
  create_directories
}

symlinking_config_files() {
  printf "symlinking config files...\n"

  # VIM
  dotfile_link "vim/.vim" "$HOME/.vim"

  # ZSH
  dotfile_link "zsh/.zshenv_wrapper" "$HOME/.zshenv"
  dotfile_link "zsh/.zshenv" "$CONFIG_DIR/zsh/.zshenv"
  dotfile_link "zsh/.zshrc" "$CONFIG_DIR/zsh/.zshrc"
  dotfile_link "zsh/.zprofile" "$CONFIG_DIR/zsh/.zprofile"

  # MUTT
  dotfile_link "mutt/.mutt" "$HOME/.mutt"

  # IMAPFILTER
  dotfile_link "imapfilter/.imapfilter" "$HOME/.imapfilter"

  # TMUX
  dotfile_link "tmux/.tmux.conf" "$HOME/.tmux.conf"
  git_install "tmux-plugins/tpm" "$CONFIG_DIR/tmux/plugins/tpm" "tmux plugin manager"

  # LF
  dotfile_link "lf/lfrc" "$CONFIG_DIR/lf/lfrc"

  # CTAGS
  dotfile_link "ctags" "$HOME/.ctags.d"

  # WTFUTIL
  dotfile_link "wtfutil/config.yml" "$CONFIG_DIR/wtf/config.yml"

  # TIG
  dotfile_link "tig/tigrc" "$HOME/.tigrc"

  # TASKWARRIOR
  dotfile_link "taskwarrior/.taskrc" "$HOME/.taskrc"

  # ALACRITTY
  dotfile_link "alacritty/alacritty.yml" "$CONFIG_DIR/alacritty/alacritty.yml"

  # TODO set up symlinking for useful scripts to ~/.local/bin

  printf "symlinking complete!\n\n"
}

check_third_party_tools() {
  printf "checking third party tools...\n"

  brew_install ag the_silver_searcher
  brew_install autojump autojump
  brew_install bat bat
  brew_install ctags universal-ctags
  brew_install exa exa
  brew_install fswatch fswatch
  brew_install fzf fzf
  brew_install gpg gnupg
  brew_install htop htop
  brew_install hub hub
  brew_install imapfilter imapfilter
  brew_install jq jq
  brew_install lf lf
  brew_install lynx lynx
  brew_install octave octave
  brew_install offlineimap offlineimap
  brew_install pandoc pandoc
  brew_install plantuml plantuml
  brew_install rg ripgrep
  brew_install tig tig
  brew_install tmux tmux
  brew_install urlview urlview
  brew_install vim "vim --HEAD"
  brew_install wtfutil wtfutil

  printf "third party tool check complete!\n\n"
}

create_directories() {
  test_and_mkdir ~/.cache/mutt mutt     # mutt cache
  test_and_mkdir ~/.task taskwarrior    # taskwarrior data
}

main
